@model  FastBookCreator.Models.Item

<div>
    @{
        var ajaxOptions = new AjaxOptions
        {
            HttpMethod = "post",
            OnSuccess = $"OnSuccess();",
            OnBegin = $"OnBegin();"
        };
    }

    @using (Ajax.BeginForm("SaveItemHTML", "Item", ajaxOptions, new { enctype = "multipart/form-data" }))
    {
        <input id="userId" class="form-control" name="userId" type="hidden" value="@ViewBag.UserId" />
        <input id="packId" class="form-control" name="packId" type="hidden" value="@ViewBag.PackId" />
        <input id="resourceId" name="resourceId" type="hidden" value="0" />
        <input id="lessonId" name="lessonId" type="hidden" value="1" />
        <input id="pageId" name="pageId" type="hidden" value="1" />
        <input id="itemTypeId" name="itemTypeId" type="hidden" value="1" />
        <input id="ckEditorHtml" class="form-control" name="content" type="hidden" />
        <div class="row">


            <div class="col-md-6 group">
                <div>
                    @Html.TextBoxFor(model => model._id, new { @class = "form-control", placeholder = Resources.Resource.Id, @readonly = "readonly" })
                    @Html.ValidationMessageFor(model => model._id)
                </div>

                <div>
                    @Html.TextBoxFor(model => model.ITEM_TITLE, new { @class = "form-control", placeholder = Resources.Resource.Name })
                    @Html.ValidationMessageFor(model => model.ITEM_TITLE)
                </div>

            </div>

            <div class="col-md-6 group">
                <div>
                    @Html.TextBoxFor(model => model.ITEM_TYPE_ID, new { @class = "form-control", placeholder = Resources.Resource.Id, @readonly = "readonly" })
                    @Html.ValidationMessageFor(model => model.ITEM_TYPE_ID)
                </div>
                <div>
                    @Html.TextBoxFor(model => model.LESSON_ID, new { @class = "form-control", placeholder = Resources.Resource.Id, @readonly = "readonly" })
                    @Html.ValidationMessageFor(model => model.LESSON_ID)
                </div>
            </div>

            <div class="col-md-12 group">
                <textarea class="code" cols="80" id="editor1" name="editor1" rows="10" style="direction: ltr; ">
                    @MvcHtmlString.Create(@Model.CONTENT)
                </textarea>
            </div>
        </div>

        <div class="row center-block">
            <button id="submit-all" type="submit" class="btn btn-default">
                <span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span>&nbsp;&nbsp; @Resources.Resource.Save
            </button>
        </div>
    }

</div>

@Html.Partial("_SearchImageDialog")

@section scripts
{
    <script type="text/javascript">

        CKEDITOR.replace('editor1', {
            extraPlugins: 'codesnippet'
        });

        $(document).ready(function () {
            $.post("../Shared/ResPacks", { where: " ", userId: "@ViewBag.UserId", packId: "@ViewBag.PackId" }, function (data) {
                var imeges = "";
                $.each(data, function (key, value) {
                    imeges = imeges + "<div class=\"img-grid col-lg-2 col-md-2 col-sm-3 col-xs-6\" >" +
                        value.NAME + value.DATA +
                        "</div>";

                });
                $("#images").html(imeges);
                $("img[id^=img-]").click(imgClick);
            });

            $("img[id^=img-]").click(imgClick);

            if ($("#imgLesson").attr("src") === "") {
                $("#imgLesson").attr("src", "../Content/images/ibook.png");
            }


        });

        $("#txtSearch")
            .on("keyup",
                function (ev) {
                    $.post("../Shared/ResPacks", { where: "WHERE NAME like '%" + this.value + "%'", userId: "@ViewBag.UserId", packId: "@ViewBag.PackId" }, function (data) {
                        var imeges = "";
                        $.each(data, function (key, value) {
                            imeges = imeges + "<div class=\"img-grid col-lg-2 col-md-2 col-sm-3 col-xs-6\" >" +
                                value.NAME + value.DATA +
                                "</div>";

                        });
                        $("#images").html(imeges);
                        $("img[id^=img-]").click(imgClick);
                    });
                });



        var imgClick = function () {
            // Do stuff, get id of image perhaps?
            $("#imgLesson").attr("src", this.src);
            $("#resourceId").val(this.alt);
            $('#searchModal').modal('toggle');
        }

        function OnSuccess() {
            $("#_id").attr("0");
            toastr.info("@Resources.Resource.Save");
            $("#LESSON_TITLE").val("");
            $("#COLOR").val("3433410");
            $("#imgLesson").attr("src", "../Content/images/ibook.png");
        }

        function OnBegin() {
            var editor_data = CKEDITOR.instances.editor1.getData();
            $("#ckEditorHtml").val(editor_data);
        }
         CKEDITOR.instances.editor1.on('change', function () {
             CKEDITOR.instances.editor1.updateElement();
            
         });
         
    </script>
}
